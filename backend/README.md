# API Documentation


> `.env.local` is not pushed to the repository because every developer should have their own local configuration. Use `.env.sample` as a template for your own local env file.

## 1 Installation

> Before you start, make sure your root folder contains `.env.[environment]` file with correct variables and url to your database 

1. Enter the pipenv shell `pipenv shell`
2. Install dependencies `pipenv install`
3. Run DB migration `flask db upgrade`
4. Download `coco.names`, `yolov3.cfg`, and `yolov3.weights` from `https://www.pyimagesearch.com/2018/11/12/yolo-object-detection-with-opencv/`

Note: If mysqlalchemy is not successfully installed, then run the command `LDFLAGS=-L/usr/local/opt/openssl/lib pip install mysqlclient`.


## 2 Running Flask server and other services

1. Enter the pipenv shell `pipenv shell`
2. Start python flask server `python app.py` 
(use `ENV=production python app.py` for production server)

After this, you should be able to see Swagger generated API Documentation at `http://localhost:5000/api`.


## 3 Adding new dependencies
Add new packages with pipenv:
```
$ pipenv install flask
```
The required dependencies are then stored in Pipfile (contrary to requirements.txt used by pip).

Read more https://opensource.com/article/18/2/why-python-devs-should-use-pipenv


## 4 File structure

```
app.py
config.py
api/
  endpoints/
  helpers.py
  parsers.py
  restplus.py
  serializers.py
  yolo.py
database/
  __init__.py
  models.py
helpers/
migrations/
uploads/
```

|                   |                                                                                                                        |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------- |
| app.py            | The entry point file that initializes flask server and database                                                        |
| config.py         | Loads .env file with variables based on ENV and populates the config object that can be imported in other files  |
| api/              | Folder containing API logic                                                                                            |
| endpoints/        | Folder for files for API endpoints. Each file should be names the same as the url namespace.                           |
| helpers.py        | File that contains most logic and communication with the DB.                                                           |
| parsers.py        | Parsers are the structure templates for body data used in POST or PUT requests.                                        |
| serializers.py    | Similar to parsers, serializers define the (JSON) structure of outputted data returned from endpoints                  |
| yolo.py           | File that contains code for performing object detection using YOLOv3. |
| database/         | Folder for database settings and models                                                                                |
| __init__.py       | Creates a database instance that can be imported from other files                                                      |
| models.py         | SQLAlchemy Representations of database tables                                                                          |
| migrations/          | Database migration versions generated by flask db init and manually edited to reflect the database structure                                               |
| uploads/          | Folder for storing photos on the local file system. |
